pipeline{
    agent any
    environment {
        dockerImage = ""
        registry = "vijendaraws/spring:2.0"
        registryCredential = "dockerhub_credential_id"
    }
    triggers {
        cron("0 * * * *")
    }
    stages{
        stage("SCM"){
            steps{
                git branch: 'main', credentialsId: 'git_credentials_id', url: 'https://github.com/Reddy-hub-sudo/spring-petclinic.git'
            }
        }
        stage("BUILD"){
            steps{
                sh "mvn clean package"
            }
        }
        stage("BUILD DOCKER IMAGE"){
            steps{
                script {
                    dockerImage = docker.build registry
                }
                
            }
        }
        stage("Push to Dockerhub"){
            steps{
              script {
                  docker.withRegistry("", registryCredential){
                      dockerImage.push()
                    }
                }
            }
        }
        stage("POSTBUILD"){
            steps{
                 junit "target/surefire-reports/*.xml"
                 archiveArtifacts "target/*.jar"
            }
        }

    }
}